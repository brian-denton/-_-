# DentonCodes.com – Next.js + Ollama AI Portfolio

> A full-stack site that auto-generates dynamic landing-page content with a local LLM, stores structured application logs in PostgreSQL, and ships with a colourful brutalist UI.

---

## ✨ Features

- **Next.js 15 / React 19** – App Router, Server & Edge runtimes.
- **Tailwind CSS** – Utility-first styling with dark-mode support.
- **AI-powered content** – Local [Ollama](https://ollama.ai/) LLM generates titles, subtitles, bios, and more.
- **Drizzle ORM + PostgreSQL** – Type-safe schema & migrations for log storage.
- **Winston logging pipeline** – Console, rotating files, and DB transport with request/session metadata.
- **Edge Middleware** – Global request logging even before hitting the server.
- **Composable UI** – Brutalist hero, footer, and Radix-based primitives.

---

## 🗂️ Project layout (high-level)

```text
├─ src/
│  ├─ app/            # Next.js pages, layouts & API routes
│  ├─ components/     # Presentational React components
│  ├─ hooks/          # Reusable React hooks
│  ├─ lib/
│  │  ├─ ai/          # Ollama client & content generator
│  │  ├─ db/          # Drizzle schema & database helpers
│  │  └─ logger/      # Multi-transport Winston logger
│  └─ middleware.ts   # Edge-runtime logger
├─ drizzle/           # SQL migrations & journal
├─ docs/LOGGING.md    # Extended logger docs
├─ OLLAMA_SETUP.md    # Local LLM installation guide
└─ README.md          # ← you are here
```

---

## ⚙️ Prerequisites

1. **Node.js ≥ 20** (18 works but 20+ recommended for 🧩 built-in `fetch`).
2. **pnpm** package manager – `npm install -g pnpm`.
3. **PostgreSQL 14+** – local instance or cloud (Supabase, Railway, Render, …).
4. **Ollama** – follow [OLLAMA_SETUP.md](./OLLAMA_SETUP.md) to install a local model.

---

## 🏗️ Setup

### 1. Clone & install dependencies

```bash
pnpm install
```

### 2. Environment variables

Create a `.env.local` file in the project root:

```dotenv
# --- Runtime ---
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000

# --- Database ---
DATABASE_URL=postgresql://postgres:password@localhost:5432/dentoncodes

# --- Logging ---
LOG_LEVEL=info                # error | warn | info | http | verbose | debug | silly
LOG_TO_FILE=true              # rotates logs in ./logs/
LOG_TO_DATABASE=true          # enables postgres transport
LOG_RETENTION_DAYS=30d        # for file rotation

# --- Edge logger ---
EDGE_LOG_ENDPOINT=http://localhost:3000/api/edge-logs

# --- Ollama ---
OLLAMA_API_URL=http://localhost:11434
OLLAMA_MODEL=llama3.2
```

> **Tip**: The original `env.example` was removed from git history—copy the block above instead.

### 3. Database 💾

1. Create the database indicated in `DATABASE_URL`.
2. Run migrations generated by Drizzle:

```bash
# generate or update SQL (edit schema first)
pnpm run db:generate

# apply pending migrations
pnpm run db:push
```

### 4. Pull an LLM model (once)

```bash
ollama pull llama3.2   # or another model listed in OLLAMA_SETUP.md
```

---

## ▶️ Running the app

```bash
pnpm dev
```

Visit `http://localhost:3000` – the brutalist hero section will fetch fresh AI-generated copy. Every request (including static page hits) is logged to console and PostgreSQL.

---

## 📡 API Routes

| Method                  | Path                    | Purpose                                   |
| ----------------------- | ----------------------- | ----------------------------------------- |
| `GET \| POST`           | `/api/generate-content` | Generate / re-generate AI portfolio text. |
| `GET \| POST \| DELETE` | `/api/logs`             | Read, write, delete log entries.          |
| `GET \| POST`           | `/api/edge-logs`        | Receive logs emitted from Edge runtime.   |

More details inside [`src/app/api/README.md`](./src/app/api/README.md).

---

## 🔍 Logging system (summary)

1. **Edge** – `middleware.ts` captures every request early, builds a minimal context, and **POSTs** it to `/api/edge-logs`.
2. **Server/API** – Route handlers create a per-request logger via `createRequestLogger()`.
3. **Core logger** – `src/lib/logger/index.ts` pipes messages to:
   - **Console** (pretty-printed in dev)
   - **Daily-rotate files** (if `LOG_TO_FILE=true`)
   - **Postgres transport** (`logs` table) batching inserts (if `LOG_TO_DATABASE=true`).

Expanded docs: [docs/LOGGING.md](./docs/LOGGING.md).

---

## 🤖 AI content generation (summary)

```mermaid
flowchart LR
    hook[useDynamicContent (React hook)] -->|fetch| API[/api/generate-content]
    API -->|calls| generator[ContentGenerator]
    generator -->|LLM| ollama[OllamaClient]
```

- **Fail-safe**: If the LLM is offline the generator falls back to deterministic random strings so the site never breaks.
- **Themes**: Pass `x-theme: chaos` header or `{ theme: "chaos" }` in POST body to force glitchy copy.

---

## 💻 Scripts

| Script              | Purpose                                           |
| ------------------- | ------------------------------------------------- |
| `pnpm dev`          | Start Next.js in development mode.                |
| `pnpm build`        | Compile & bundle for production.                  |
| `pnpm start`        | Start the production server (after `build`).      |
| `pnpm db:generate`  | Re-generate SQL from `schema.ts`.                 |
| `pnpm db:push`      | Apply migrations to the DB.                       |
| `pnpm db:migrate`   | Run Drizzle migrations in production.             |
| `pnpm db:studio`    | Visual schema explorer.                           |
| `pnpm logs:cleanup` | Reminder to use `DELETE /api/logs` for retention. |
| `pnpm logs:test`    | Prints info on how to create test logs via UI.    |

---

## 🐳 Deployment notes

1. **Database** – supply `DATABASE_URL` env on the hosting platform (Supabase, Railway, Neon, …).
2. **Edge logging** – point `EDGE_LOG_ENDPOINT` to the production domain or disable it.
3. **Ollama** – For serverless hosting you'll need a remote Ollama instance; otherwise set `OLLAMA_API_URL` to a public URL.
4. **Static assets** – Next.js App Router outputs an `app/` build compatible with Vercel, Netlify, Fly.io, etc.

---

## 🧑‍💻 Contributing

1. Fork & clone the repo.
2. `pnpm install`
3. Create a feature branch
4. Commit using [Conventional Commits](https://www.conventionalcommits.org/).
5. Open a PR – GitHub Actions (CI) will lint, type-check, and run build.

---

## 📜 License

MIT © 2025 Denton Codes
